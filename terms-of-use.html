<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cutters Choice Radio â€” Schedule</title>

  <!-- Site CSS + Fonts -->
  <link rel="stylesheet" href="style.css?v=1755569209645" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- NAV + SCHEDULE STYLES -->
  <style>
    :root{
      --brand-teal:#5A8785;
      --hourH:52px;                 /* height per hour */
      --qH:calc(var(--hourH)/4);    /* 15-min slots */
    }

    /* NAV */
    #main-nav{
      display:flex!important; align-items:center!important;
      gap:.5rem!important; width:100%!important;
      padding:.10rem .65rem!important; margin:0!important;
      box-sizing:border-box!important;
      background-color:var(--brand-teal)!important;
      position:relative!important; z-index:1000!important;
      border-top:2px solid #000; border-bottom:2px solid #000;
    }
    #main-nav .nav-menu{
      display:flex!important; align-items:center!important;
      justify-content:space-evenly!important;
      gap:clamp(.25rem,2vw,1.5rem)!important;
      flex:1 1 auto!important;
    }
    #main-nav a.nav-link{
      color:#fff!important; font-family:'Bebas Neue',sans-serif!important;
      font-size:2rem!important; text-transform:uppercase!important;
      text-decoration:none!important; white-space:nowrap!important;
    }
    #main-nav .nav-actions{ display:flex!important; align-items:center!important; justify-content:flex-end!important; gap:.6rem!important; }
    #main-nav .social-icon{ display:inline-flex!important; align-items:center!important; justify-content:center!important; color:#fff!important; text-decoration:none!important; line-height:1!important; }
    #main-nav .social-icon i{ font-size:2.1rem!important; }
    #main-nav .icon-img{ width:2.6rem!important; height:auto!important; margin-left:.25rem!important; }
    #main-nav .nav-onemusic{ display:flex; align-items:center; }
    #main-nav .nav-onemusic img{ max-height:2rem; width:auto; height:auto; display:block; }
    #manualCastBtn{ background:none; border:none; color:#fff; font-size:1.8rem; cursor:pointer; margin-left:.25rem; }

    @media (max-width:768px){
      #main-nav a.nav-link{ font-size:1rem!important; }
      #main-nav .nav-menu{ justify-content:space-between!important; gap:.5rem!important; }
      #main-nav .social-icon i{ font-size:1.4rem!important; }
      #main-nav .icon-img, #main-nav .nav-onemusic{ display:none!important; }
    }

    /* PAGE base */
    html,body{ background:#000; color:#fafafa; }
    *{ box-sizing:border-box; }

    /* Header bar */
    .page-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:.5rem .75rem; border-bottom:2px solid #000; background:var(--brand-teal);
      opacity:1 !important; filter:none !important;
    }
    .page-header h1{
      font-family:'Bebas Neue',sans-serif; font-size:2.2rem;
      letter-spacing:.5px; margin:0; text-shadow:0 1px 0 rgba(0,0,0,.35);
      color:#fff !important; opacity:1 !important; filter:none !important; mix-blend-mode:normal !important;
      -webkit-text-fill-color:#fff !important;
    }

    .utilities{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
    .legend{display:flex;gap:.5rem;align-items:center}
    .chip{width:.9rem;height:.9rem;border-radius:2px;border:1px solid #1f1f1f;display:inline-block}

    /* Controls row (period title, tz, arrows) */
    .month-controls{
      display:flex; gap:.5rem; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--brand-teal); padding:.75rem .75rem;
      position:sticky; top:0; background:#000; z-index:20;
    }
    .month-controls .title{
      font-family:'Bebas Neue',sans-serif; font-size:2rem; letter-spacing:.5px;
      text-shadow:0 1px 0 rgba(0,0,0,.35);
      color:#fff !important; opacity:1 !important; filter:none !important; mix-blend-mode:normal !important;
      -webkit-text-fill-color:#fff !important;
    }
    .ccr-btn{
      background:var(--brand-teal); color:#fff; border:none; border-radius:6px;
      padding:.5rem .75rem; cursor:pointer; font-weight:600; letter-spacing:.3px;
    }

    .weeks-stack{ display:flex; flex-direction:column; gap:1.25rem; padding:1rem .75rem 2rem; }

    /* DESKTOP week grid */
    .week-grid{
      display:grid;
      grid-template-columns:64px repeat(7,1fr);
      grid-template-rows:auto 1fr;   /* row 1 = headers, row 2 = bodies */
      gap:6px;
      border:2px solid var(--brand-teal); border-radius:8px;
      overflow:hidden; background:#0f0f0f; padding:6px;
    }
    .time-head{ grid-column:1; grid-row:1; }

    /* Time ruler */
    .time-col{
      grid-column:1; grid-row:2;
      position:relative; height:calc(var(--hourH)*24); border:1px solid #1c1c1c; border-radius:6px;
      background-color:#0b0b0b;
      background-image:linear-gradient(to bottom,#1e1e1e 1px,transparent 1px);
      background-size:100% var(--hourH);
    }
    .time-col .hour-label{
      position:absolute; left:6px;
      font-size:1rem; color:#fff !important; line-height:1;
      text-shadow:0 1px 0 rgba(0,0,0,.35);
      pointer-events:none;
    }

    /* Day headers */
    .day-head{
      grid-row:1;
      background:#0d0d0d; border:1px solid #1e1e1e; padding:.48rem .6rem;
      border-radius:6px;
      color:#fff !important; opacity:1 !important; filter:none !important; mix-blend-mode:normal !important;
    }
    .day-head .dow{
      font-family:'Bebas Neue',sans-serif;
      font-size:1.38rem;
      color:#fff !important; opacity:1 !important; filter:none !important; mix-blend-mode:normal !important;
      text-shadow:0 1px 0 rgba(0,0,0,.35);
      -webkit-text-fill-color:#fff !important;
    }
    .day-head .date{
      font-size:1.06rem;
      color:#fff !important; opacity:1 !important; filter:none !important; mix-blend-mode:normal !important;
      text-shadow:0 1px 0 rgba(0,0,0,.35);
      -webkit-text-fill-color:#fff !important;
    }

    /* Day bodies */
    .day-body{
      grid-row:2;
      display:grid; grid-template-rows:repeat(96,var(--qH)); position:relative;
      height:calc(var(--hourH)*24); border:1px solid #1c1c1c; border-radius:6px; overflow:hidden;
      background-color:#0b0b0b;
      background-image:linear-gradient(to bottom,#1a1a1a 1px,transparent 1px);
      background-size:100% var(--hourH);
    }

    /* Show cards */
    .show{
      grid-column:1/-1; margin:2px 4px;
      background:var(--chip,#FBBF24); color:var(--fg,#1b0f00);
      border-radius:10px; padding:.48rem .6rem; overflow:hidden;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.2);
    }
    .show .time{ font-size:.78rem; opacity:.95; }
    .show .title{ font-weight:800; line-height:1.2; }
    .show .host{ font-size:.85rem; opacity:.92; }

    /* Palette */
    .tone-1{--chip:#FBBF24;--fg:#1b0f00}
    .tone-2{--chip:#FB923C;--fg:#1a0900}
    .tone-3{--chip:#EC4899;--fg:#220713}
    .tone-4{--chip:#A78BFA;--fg:#0e0a1a}
    .tone-5{--chip:#06B6D4;--fg:#001318}
    .tone-6{--chip:#60A5FA;--fg:#0a1a35}
    .tone-7{--chip:#10B981;--fg:#00150e}
    .tone-8{--chip:#4ADE80;--fg:#041307}
    .is-archive{--chip:#93C5FD;--fg:#0b1f3f}

    /* ===== MOBILE LAYOUT ===== */
    @media (max-width:980px){
      .weeks-stack{ gap:1rem; padding:.5rem .5rem 1.25rem; }
      .week-grid{ display:block; padding:0; border:none; background:transparent; }
      .time-head, .time-col{ display:none !important; } /* hide left ruler */

      .day-head{
        margin:12px 8px 0; padding:.55rem .7rem; border-radius:12px;
      }
      .day-head .dow{ font-size:1.22rem; }
      .day-head .date{ font-size:1rem; }

      .day-body{
        margin:6px 8px 8px; border-radius:14px;
        height:calc(var(--hourH)*24);
      }
      .show{ padding:.44rem .55rem; margin:2px 3px; }
      .show .time{ font-size:.84rem; }
      .show .title{ font-size:.98rem; }
      .show .host{ font-size:.84rem; }
    }

    /* ===== NUCLEAR WHITE OVERRIDE =====
       Defuses any dimming from global CSS (opacity, blend modes, text-fill, etc.)
    */
    :where(.page-header, .page-header *, .month-controls .title,
           .week-grid .day-head, .week-grid .day-head *){
      color:#fff !important;
      opacity:1 !important;
      filter:none !important;
      mix-blend-mode:normal !important;
      -webkit-text-fill-color:#fff !important;
    }

    /* Footer */
    .banner{display:flex;gap:1rem;justify-content:center;padding:1rem;border-top:2px solid #000}
    .banner a{color:#fff;text-decoration:none}
  </style>

  <!-- Chromecast init -->
  <script>
    window.__onGCastApiAvailable = isAvailable => {
      if (isAvailable) {
        cast.framework.CastContext.getInstance().setOptions({
          receiverApplicationId: '77E0F81B',
          autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
        });
      }
    };
  </script>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>

<body>
  <!-- NAV -->
  <nav id="main-nav">
    <div class="nav-menu">
      <a href="index.html"        class="nav-link">HOME</a>
      <a href="our-story.html"    class="nav-link">OUR STORY</a>
      <a href="index-ourDJS.html" class="nav-link">OUR DJS</a>
      <a href="merch.html"        class="nav-link">MERCH</a>
    </div>

    <div class="nav-actions">
      <a href="https://facebook.com/cutterschoiceradio"  target="_blank" class="social-icon" aria-label="Facebook">
        <i class="fab fa-facebook-f"></i>
      </a>
      <a href="https://instagram.com/cutterschoiceradio" target="_blank" class="social-icon" aria-label="Instagram">
        <i class="fab fa-instagram"></i>
      </a>
      <img src="/images/alexa-logo.webp" alt="Alexa" class="icon-img" loading="lazy">
      <a href="https://tunein.com/radio/Cutters-Choice-Radio-s344746/" target="_blank" aria-label="TuneIn">
        <img src="/images/tunein-logo.png" alt="TuneIn" class="icon-img" loading="lazy">
      </a>
      <div class="nav-onemusic">
        <a href="https://onemusicnz.com" target="_blank" rel="noopener">
          <img src="/images/ONEMUSICLOGO.png" alt="Weâ€™re licensed to play OneMusic NZ" loading="lazy">
        </a>
      </div>
      <google-cast-button></google-cast-button>
      <button id="manualCastBtn" title="Cast this stream"><i class="fab fa-chromecast"></i></button>
    </div>
  </nav>

  <header class="page-header">
    <h1>MONTHLY SCHEDULE</h1>
    <div class="utilities">
      <button class="ccr-btn" id="todayBtn" title="Jump to current 4-week block">This Week</button>
      <div class="legend">
        <span class="chip" style="background:#FBBF24"></span>
        <span class="chip" style="background:#FB923C"></span>
        <span class="chip" style="background:#EC4899"></span>
        <span class="chip" style="background:#A78BFA"></span>
        <span class="chip" style="background:#06B6D4"></span>
        <span class="chip" style="background:#60A5FA"></span>
        <span class="chip" style="background:#10B981"></span>
        <span class="chip" style="background:#4ADE80"></span>
        <small style="opacity:.95;color:#fff">Order of shows each UK day</small>
        <span class="chip" style="background:#93C5FD;margin-left:.5rem;"></span>
        <small style="opacity:.95;color:#fff">Archives</small>
      </div>
    </div>
  </header>

  <section class="month-controls">
    <div>
      <button class="ccr-btn" id="prevMonthBtn" aria-label="Previous 4 weeks">â—€</button>
      <button class="ccr-btn" id="nextMonthBtn" aria-label="Next 4 weeks">â–¶</button>
    </div>
    <div class="title" id="monthTitle">Loadingâ€¦</div>
    <div>
      <label style="display:flex;align-items:center;gap:.35rem;">
        <span style="font-size:.95rem;color:#fff">Times in</span>
        <select id="tzSelect" class="ccr-btn" style="background:#0a0a0a;border:1px solid #1c1c1c;color:#fff">
          <option value="local">Your local time</option>
          <option value="Europe/London">UK (Europe/London)</option>
          <option value="UTC">UTC</option>
        </select>
      </label>
    </div>
  </section>

  <main class="weeks-stack" id="weeksStack" aria-live="polite">
    <p style="opacity:.8;color:#fff">Fetchingâ€¦</p>
  </main>

  <footer class="banner">
    <a href="privacy-policy.html">PRIVACY POLICY</a>
    <a href="index.html">Back to Home</a>
  </footer>

  <script>
    /* ===== API ===== */
    const API_KEY    = "pk_0b8abc6f834b444f949f727e88a728e0";
    const STATION_ID = "cutters-choice-radio";
    const BASE_URL   = "https://api.radiocult.fm/api";
    const rcFetch    = async (path) => {
      const res = await fetch(BASE_URL + path, { headers: { "x-api-key": API_KEY } });
      if (!res.ok) throw new Error(`Fetch error ${res.status}`);
      return res.json();
    };

    /* ===== Date helpers ===== */
    const pad = n => String(n).padStart(2,"0");
    const addDaysUTC = (d, n) => { const x = new Date(d); x.setUTCDate(x.getUTCDate()+n); return x; };
    const startOfWeekUTC = (date) => { const d=new Date(Date.UTC(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate())); const day=(d.getUTCDay()+6)%7; d.setUTCDate(d.getUTCDate()-day); d.setUTCHours(0,0,0,0); return d; };

    /* yyyy-mm-dd in chosen tz */
    const ymdInTz = (d, tz) => new Intl.DateTimeFormat('en-CA',{
      timeZone: tz==='local'?undefined:tz, year:'numeric',month:'2-digit',day:'2-digit'
    }).format(d);

    /* minutes since day start in tz */
    const minutesInDay = (d, tz) => {
      const parts = new Intl.DateTimeFormat('en-GB',{
        timeZone: tz==='local'?undefined:tz, hour:'2-digit', minute:'2-digit', hour12:false
      }).formatToParts(d);
      let hh=0,mm=0; for(const p of parts){ if(p.type==='hour') hh=parseInt(p.value,10); if(p.type==='minute') mm=parseInt(p.value,10); }
      return hh*60+mm;
    };

    const fmtHM = (min) => {
      let h = Math.floor(min/60), m = min % 60;
      const ampm = h >= 12 ? 'pm' : 'am';
      let hh = ((h + 11) % 12) + 1;
      return `${String(hh).padStart(2,'0')}:${String(m).padStart(2,'0')} ${ampm}`;
    };

    /* labels in tz */
    const dowInTz = (d, tz) =>
      new Intl.DateTimeFormat('en-GB', { timeZone: tz === 'local' ? undefined : tz, weekday:'short' })
      .format(d).toUpperCase();

    const fmtDMtz = (d, tz) =>
      new Intl.DateTimeFormat(undefined, { timeZone: tz === 'local' ? undefined : tz, day:'numeric', month:'short' })
      .format(d);

    const rangeLabelInTz = (startUtc, endUtc, tz) => {
      const f = (d,opts)=> new Intl.DateTimeFormat(undefined, { ...(tz==='local'?{}:{timeZone:tz}), ...opts }).format(d);
      const same = f(startUtc,{month:'numeric',year:'numeric'}) === f(endUtc,{month:'numeric',year:'numeric'});
      if (same) return `${f(startUtc,{month:'long',year:'numeric'})} â€¢ ${f(startUtc,{day:'2-digit',month:'short'})}â€“${f(endUtc,{day:'2-digit'})}`;
      return `${f(startUtc,{day:'2-digit',month:'short'})} â€“ ${f(endUtc,{day:'2-digit',month:'short',year:'numeric'})}`;
    };

    /* fetch 4-week block */
    async function fetchRange(startUtc, endUtc) {
      const paddedStart = addDaysUTC(startUtc, -1).toISOString();
      const paddedEnd   = addDaysUTC(endUtc,   1).toISOString();
      const { schedules = [] } = await rcFetch(`/station/${STATION_ID}/schedule?startDate=${encodeURIComponent(paddedStart)}&endDate=${encodeURIComponent(paddedEnd)}`);
      return schedules.map(s => ({
        start: s.startDateUtc || s.startDate || s.startAt || s.start,
        end:   s.endDateUtc   || s.endDate   || s.endAt   || s.end,
        title: s.title || s.content?.title || s.content?.name || "Untitled show",
        host:  (Array.isArray(s.content?.presenters) ? s.content.presenters.map(p => p.name).filter(Boolean).join(", ") : "")
               || s.metadata?.artist || s.dj || "",
        raw: s
      })).filter(s => s.start && s.end);
    }

    /* color rules */
    const ORDER_CLASSES = ['tone-1','tone-2','tone-3','tone-4','tone-5','tone-6','tone-7','tone-8'];
    const isArchive = (s) => {
      const blob = `${s.title||''} ${s.host||''}`.toLowerCase();
      return blob.includes('archive') || blob.includes('archives');
    };

    /* split overnight & fill gaps */
    const pad2 = n=>String(n).padStart(2,'0');
    const incYMD = (s) => { const [y,m,d]=s.split('-').map(Number); const dt=new Date(Date.UTC(y,m-1,d)); dt.setUTCDate(dt.getUTCDate()+1); return `${dt.getUTCFullYear()}-${pad2(dt.getUTCMonth()+1)}-${pad2(dt.getUTCDate())}`; };

    function splitShowsIntoDailySegments(shows, tz) {
      const map = new Map();
      for (const s of shows) {
        const st = new Date(s.start), en = new Date(s.end);
        const kStart = ymdInTz(st, tz), kEnd = ymdInTz(en, tz);
        let key = kStart;
        while (true) {
          const segStartMin = (key===kStart) ? minutesInDay(st, tz) : 0;
          const segEndMin   = (key===kEnd)   ? minutesInDay(en, tz) : 24*60;
          const seg = { ...s, segStartMin, segEndMin: Math.max(segStartMin+15, segEndMin), archive: isArchive(s) };
          if (!map.has(key)) map.set(key, []);
          map.get(key).push(seg);
          if (key===kEnd) break;
          key = incYMD(key);
        }
      }
      for (const [key, arr] of map) {
        arr.sort((a,b)=> a.segStartMin - b.segStartMin);
        const filled = []; let cur = 0;
        for (const seg of arr) {
          if (seg.segStartMin > cur) filled.push({ title:"Choice Cuts Archives", host:"", archive:true, segStartMin:cur, segEndMin:seg.segStartMin });
          filled.push(seg);
          cur = Math.max(cur, seg.segEndMin);
        }
        if (cur < 24*60) filled.push({ title:"Choice Cuts Archives", host:"", archive:true, segStartMin:cur, segEndMin:24*60 });
        map.set(key, filled);
      }
      return map;
    }

    function buildUkOrderLookup(shows){
      const tz = 'Europe/London';
      const byDay = new Map();
      for(const s of shows){
        if (isArchive(s)) continue;
        const st = new Date(s.start);
        const key = ymdInTz(st, tz);
        if(!byDay.has(key)) byDay.set(key, []);
        byDay.get(key).push(s);
      }
      for(const [,arr] of byDay){ arr.sort((a,b)=> new Date(a.start) - new Date(b.start)); }
      const lookup = new Map();
      for(const [,arr] of byDay){
        arr.forEach((s, idx)=>{
          const key = (s.start||'') + '|' + (s.title||'');
          lookup.set(key, idx);
        });
      }
      return lookup;
    }

    /* time ruler */
    function buildTimeRuler(){
      const col=document.createElement('div'); col.className='time-col';
      for(let h=0;h<24;h++){
        const lab=document.createElement('div'); lab.className='hour-label';
        lab.style.top=`calc(${h} * var(--hourH))`;
        lab.textContent=String(h).padStart(2,'0')+':00';
        col.appendChild(lab);
      }
      return col;
    }

    function renderFourWeeks(anchorUtc, shows, tz, ukOrderLookup){
      const mount=document.getElementById('weeksStack'); mount.innerHTML='';
      const endUtc = addDaysUTC(anchorUtc, 27);
      document.getElementById('monthTitle').textContent = rangeLabelInTz(anchorUtc, endUtc, tz);

      const buckets = splitShowsIntoDailySegments(shows, tz);

      for (let w=0; w<4; w++){
        const weekEl=document.createElement('section'); weekEl.className='week-grid';

        const spacer=document.createElement('div'); spacer.className='time-head';
        weekEl.appendChild(spacer);

        /* ruler (hidden on mobile) */
        weekEl.appendChild(buildTimeRuler());

        /* interleave headers & bodies to help mobile flow */
        for(let i=0;i<7;i++){
          const dayUtc = addDaysUTC(anchorUtc, w*7 + i);

          const head=document.createElement('div'); head.className='day-head';
          head.style.gridColumn = String(i+2);
          head.innerHTML = `
            <div class="dow">${dowInTz(dayUtc, tz)}</div>
            <div class="date">${fmtDMtz(dayUtc, tz)}</div>
          `;
          weekEl.appendChild(head);

          const body=document.createElement('div'); body.className='day-body';
          body.style.gridColumn = String(i+2);

          const dayKey = ymdInTz(dayUtc, tz);
          const segments = buckets.get(dayKey) || [];

          segments.forEach(seg=>{
            const startQ = Math.floor(seg.segStartMin/15);
            const spanQ  = Math.max(1, Math.ceil((seg.segEndMin - seg.segStartMin)/15));
            const show=document.createElement('div');
            let classes = 'show ';
            if (seg.archive) {
              classes += 'is-archive';
            } else {
              const key = (seg.start||'') + '|' + (seg.title||'');
              const ord = ukOrderLookup.get(key) ?? 0;
              classes += ORDER_CLASSES[ord % ORDER_CLASSES.length];
            }
            show.className = classes;
            show.style.gridRow = `${startQ+1} / span ${spanQ}`;
            show.innerHTML = `
              <div class="time">${fmtHM(seg.segStartMin)}â€“${fmtHM(seg.segEndMin)}</div>
              <div class="title">${String(seg.title).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
              ${seg.host ? `<div class="host">${String(seg.host).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>` : ""}
            `;
            body.appendChild(show);
          });

          weekEl.appendChild(body);
        }

        mount.appendChild(weekEl);
      }
    }

    /* state & controls */
    const addDaysUTC = (d,n)=>{const x=new Date(d);x.setUTCDate(x.getUTCDate()+n);return x;}; // redeclared for scoping in some bundlers
    let anchorUtc = (function startOfWeekUTC(date){const d=new Date(Date.UTC(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate()));const day=(d.getUTCDay()+6)%7;d.setUTCDate(d.getUTCDate()-day);d.setUTCHours(0,0,0,0);return d;})(new Date());
    let tzMode = "local";

    async function loadBlock(){
      const blockStart = anchorUtc;
      const blockEnd   = addDaysUTC(anchorUtc, 28);
      try{
        const shows=await fetchRange(blockStart, blockEnd);
        const ukOrderLookup = buildUkOrderLookup(shows);
        renderFourWeeks(blockStart, shows, tzMode, ukOrderLookup);
      }catch(e){
        console.error(e);
        document.getElementById('weeksStack').innerHTML="<p style='color:#fff'>Couldnâ€™t load schedule.</p>";
      }
    }

    document.getElementById('prevMonthBtn').addEventListener('click',()=>{ anchorUtc = addDaysUTC(anchorUtc, -28); loadBlock(); window.scrollTo({top:0}); });
    document.getElementById('nextMonthBtn').addEventListener('click',()=>{ anchorUtc = addDaysUTC(anchorUtc, +28); loadBlock(); window.scrollTo({top:0}); });
    document.getElementById('todayBtn').addEventListener('click',()=>{ anchorUtc = (function(d){const x=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()));const k=(x.getUTCDay()+6)%7;x.setUTCDate(x.getUTCDate()-k);x.setUTCHours(0,0,0,0);return x;})(new Date()); loadBlock(); window.scrollTo({top:0,behavior:'smooth'}); });
    document.getElementById('tzSelect').addEventListener('change',e=>{ tzMode=e.target.value; loadBlock(); });

    loadBlock();

    /* cast fallback */
    document.getElementById('manualCastBtn')?.addEventListener('click',()=>{
      const context = cast.framework.CastContext.getInstance();
      context.requestSession().catch(err=>console.error('Fallback session error',err));
    });
  </script>
</body>
</html>
